{"title":"Tour Generation Action","steps":[{"filePath":"C:/Users/bajic/source/repos/JB-plugin/src/main/java/com/hackathon/actions/CreateTourModeAction.java","lineNum":21,"codeSnippet":"    public void update(@NotNull AnActionEvent e) {\n        Editor editor \u003d e.getData(CommonDataKeys.EDITOR);\n        Project project \u003d e.getProject();\n        boolean visible \u003d false;\n        if (editor !\u003d null \u0026\u0026 project !\u003d null) {\n            SelectionModeService svc \u003d project.getService(SelectionModeService.class);\n            // Visible only if selection mode is NOT enabled\n            visible \u003d svc !\u003d null \u0026\u0026 !svc.isEnabled();\n        }\n        e.getPresentation().setEnabledAndVisible(visible);\n    }","authorNote":"","aiExplanation":"\u003ch3\u003eSummary\u003c/h3\u003e\u003cp\u003eThis method updates the visibility of an action based on the current editor and project context. It checks if the selection mode is enabled and sets the action\u0027s presentation accordingly. Example call: update(anActionEventInstance).\u003c/p\u003e","endLine":31,"symbolName":"com.hackathon.actions.CreateTourModeAction#update","type":"method"},{"filePath":"C:/Users/bajic/source/repos/JB-plugin/src/main/java/com/hackathon/actions/CreateTourModeAction.java","lineNum":34,"codeSnippet":"    public void actionPerformed(@NotNull AnActionEvent e) {\n        Project project \u003d e.getProject();\n        if (project \u003d\u003d null) return;\n        SelectionModeService svc \u003d project.getService(SelectionModeService.class);\n\n        // End any running tour\n        AnAction endTourAction \u003d ActionManager.getInstance().getAction(\"com.hackathon.actions.EndTourAction\");\n        if (endTourAction !\u003d null) {\n            endTourAction.actionPerformed(e);\n        }\n\n        svc.setEnabled(true);\n        Messages.showInfoMessage(project,\n                \"Selection mode enabled. Click methods/classes to add or remove them from the tour. Use \u0027Create Tour (Generate JSON)\u0027 to finalize.\",\n                \"Create Tour\");\n    }","authorNote":"","aiExplanation":"\u003ch3\u003eSummary\u003c/h3\u003e\u003cp\u003eThis method handles the action of enabling selection mode for creating a tour in a project. It checks if a project is available, ends any currently running tour, and then enables the selection mode service. A message is displayed to inform the user about how to add or remove items from the tour and how to finalize it. Example call: actionPerformed(event).\u003c/p\u003e","endLine":49,"symbolName":"com.hackathon.actions.CreateTourModeAction#actionPerformed","type":"method"},{"filePath":"C:/Users/bajic/source/repos/JB-plugin/src/main/java/com/hackathon/actions/GenerateJavadocForTourAction.java","lineNum":27,"codeSnippet":"public class GenerateJavadocForTourAction extends AnAction {\n\n    @Override\n    public void actionPerformed(@NotNull AnActionEvent e) {\n        Project project \u003d e.getProject();\n        if (project \u003d\u003d null) return;\n        TourStateService state \u003d project.getService(TourStateService.class);\n        if (state.getSteps().isEmpty()) {\n            Messages.showInfoMessage(project, \"No tour loaded or steps present.\", \"Generate Javadoc\");\n            return;\n        }\n\n        int[] updated \u003d {0};\n        WriteCommandAction.runWriteCommandAction(project, \"Generate Javadoc for Tour\", null, () -\u003e {\n            for (TourStep step : state.getSteps()) {\n                VirtualFile vFile \u003d LocalFileSystem.getInstance().findFileByPath(step.filePath());\n                if (vFile \u003d\u003d null) continue;\n                PsiFile psiFile \u003d PsiManager.getInstance(project).findFile(vFile);\n                if (!(psiFile instanceof PsiJavaFile)) continue;\n\n                int line0 \u003d Math.max(0, step.lineNum() - 1);\n                Document document \u003d PsiDocumentManager.getInstance(project).getDocument(psiFile);\n                if (document \u003d\u003d null || line0 \u003e\u003d document.getLineCount()) continue;\n                int offset \u003d document.getLineStartOffset(line0);\n                PsiElement el \u003d psiFile.findElementAt(offset);\n                PsiElement symbol \u003d findEnclosing(el);\n                if (!(symbol instanceof PsiDocCommentOwner owner)) continue;\n\n                String acwBlock \u003d buildAcwBlockFromHtml(step);\n                if (acwBlock \u003d\u003d null) continue;\n                applyOrUpdateJavadoc(project, owner, acwBlock);\n                updated[0]++;\n            }\n        });\n\n        Messages.showInfoMessage(project, \"Updated Javadoc for \" + updated[0] + \" element(s).\", \"Generate Javadoc\");\n    }\n\n    private static PsiElement findEnclosing(PsiElement el) {\n        while (el !\u003d null \u0026\u0026 !(el instanceof PsiMethod) \u0026\u0026 !(el instanceof PsiClass)) {\n            el \u003d el.getParent();\n        }\n        return el;\n    }\n\n    // Build only our ACW block with markers: include AI explanation text and the author\u0027s note. No code blocks.\n    private static String buildAcwBlockFromHtml(TourStep step) {\n        String html \u003d step.aiExplanation();\n        if (html \u003d\u003d null) html \u003d \"\";\n        String authorNote \u003d step.authorNote() \u003d\u003d null ? \"\" : step.authorNote();\n\n        // Strip tags to plain text for Javadoc body\n        String text \u003d html\n                .replaceAll(\"(?is)\u003cscript.*?\u003c/script\u003e\", \"\")\n                .replaceAll(\"(?is)\u003cstyle.*?\u003c/style\u003e\", \"\")\n                .replaceAll(\"(?is)\u003c[^\u003e]+\u003e\", \"\")\n                .replace(\"\u0026lt;\", \"\u003c\")\n                .replace(\"\u0026gt;\", \"\u003e\")\n                .replace(\"\u0026amp;\", \"\u0026\");\n\n        StringBuilder sb \u003d new StringBuilder();\n        sb.append(\" * \u003cACW-BEGIN\u003e\\n\");\n        if (!text.isBlank()) {\n            for (String line : escapeForJavadoc(text).split(\"\\r?\\n\")) {\n                if (!line.isBlank()) sb.append(\" * \").append(line).append(\"\\n\");\n            }\n        }\n        if (!authorNote.isBlank()) {\n            sb.append(\" * \u003cp\u003eAuthor note:\u003c/p\u003e\\n\");\n            for (String line : authorNote.split(\"\\r?\\n\")) {\n                sb.append(\" * \").append(escapeForJavadoc(line)).append(\"\\n\");\n            }\n        }\n        sb.append(\" * \u003cACW-END\u003e\\n\");\n        return sb.toString();\n    }\n\n    private static String escapeForJavadoc(String s) {\n        return s.replace(\"*/\", \"*\\\\/\" );\n    }\n\n    private static void applyOrUpdateJavadoc(Project project, PsiDocCommentOwner owner, String acwBlock) {\n        PsiElementFactory factory \u003d JavaPsiFacade.getElementFactory(project);\n        PsiDocComment existing \u003d owner.getDocComment();\n\n        StringBuilder docText \u003d new StringBuilder();\n        docText.append(\"/**\\n\");\n\n        if (existing !\u003d null) {\n            // Add our ACW block as the main description, replacing old description\n            docText.append(acwBlock);\n\n            // Preserve tags\n            PsiDocTag[] tags \u003d existing.getTags();\n            if (tags.length \u003e 0) {\n                docText.append(\" *\\n\");\n                for (PsiDocTag tag : tags) {\n                    String t \u003d tag.getText();\n                    for (String ln : t.split(\"\\r?\\n\")) {\n                        docText.append(\" * \").append(ln.trim()).append(\"\\n\");\n                    }\n                }\n            }\n        } else {\n            // No existing: just ACW block\n            docText.append(acwBlock);\n        }\n\n        docText.append(\" */\");\n\n        PsiDocComment newDoc \u003d factory.createDocCommentFromText(docText.toString());\n        if (existing !\u003d null) {\n            existing.replace(newDoc);\n        } else {\n            owner.addBefore(newDoc, owner.getFirstChild());\n        }\n    }\n}","authorNote":"","aiExplanation":"\u003ch3\u003eSummary\u003c/h3\u003e\u003cp\u003eThis class defines an action that generates or updates Javadoc comments for Java elements based on a predefined tour state. It retrieves tour steps, processes each step to extract relevant information, and constructs a Javadoc block that includes AI explanations and author notes. The generated Javadoc is then applied to the corresponding Java elements in the project. Example usage: Trigger the action to automatically generate Javadoc for all steps in the current tour.\u003c/p\u003e","endLine":144,"symbolName":"com.hackathon.actions.GenerateJavadocForTourAction","type":"class"},{"filePath":"C:/Users/bajic/source/repos/JB-plugin/src/main/java/com/hackathon/actions/AddStepAction.java","lineNum":28,"codeSnippet":"    public void update(@NotNull AnActionEvent e) {\n        Editor editor \u003d e.getData(CommonDataKeys.EDITOR);\n        boolean visible \u003d false;\n        if (editor !\u003d null \u0026\u0026 editor.getProject() !\u003d null) {\n            com.hackathon.service.SelectionModeService sel \u003d editor.getProject().getService(com.hackathon.service.SelectionModeService.class);\n            visible \u003d sel !\u003d null \u0026\u0026 sel.isEnabled();\n        }\n        e.getPresentation().setEnabledAndVisible(visible);\n    }","authorNote":"","aiExplanation":"\u003ch3\u003eSummary\u003c/h3\u003e\u003cp\u003eThis method updates the visibility and enabled state of an action based on the current editor and project context. It checks if the editor is not null and if the project associated with it has a specific service enabled. If both conditions are met, the action is set to be visible and enabled. Example call: update(event).\u003c/p\u003e","endLine":36,"symbolName":"com.hackathon.actions.AddStepAction#update","type":"method"}]}